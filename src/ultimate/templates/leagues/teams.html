{% extends "layout/layout_user.html" %}

{% load staticfiles %}
{% load teams %}
{% load user_roles %}
{% load utility %}

{% block content %}
<div class="page-division-teams">

  {% include 'layout/league_header.html' with league=league only %}

  {% include 'layout/league_tabs.html' with selected_tab='teams' %}

  <div class="page-division-teams-schedule">
    {% if game_dates|length %}
    {% include '_partials/schedule_table.html' with league=league columns=columns game_dates=game_dates user_games=user_games next_game_date=next_game_date only %}

    {% if league.schedule_note %}
    <p class="page-division-teams-schedule-notes">
      {{ league.schedule_note }}
    </p>
    {% endif %}
    {% else %}
    <h4>
      Schedules are not yet available
    </h4>
    {% endif %}
  </div>

  <div class="page-division-teams-teams">
    <div class="page-division-teams-teams-row">
      {% for team in teams %}
      <div class="page-division-teams-teams-row-team team" id="team-roster-{{ team.id }}">
        <div class="team_info" style="background-color: {{ team.css_background_color }}; color: {{ team.css_text_color }}">
          <div class="team_name" style="font-size: {{ team.name|get_team_name_font_size }}px;">
            {% if team.name %}
              {{ team.name }}
            {% else %}
              Team {{ team.id }}
            {% endif %}
          </div>

          <div>
            {% if team.email and user.is_authenticated%}
            {% if user|is_on_team:team or user.is_superuser %}
              <a style="color: {{ team.css_text_color }}" href="mailto:{{ team.email }}">Email Team</a>
            {% endif %}
            {% endif %}

            <div>
              {% if team.name %}
                Team {{ team.id }}
                {% if team.color %}
                  -
                {% endif %}
              {% endif %}

              {{ team.color }}

              {% if not team.name and not team.color %}
                &nbsp;
              {% endif %}
            </div>
          </div>
        </div>

        <ul class="team_members">
          {% for team_member in team.get_members %}
            <li class="team_member">
              {% if forloop.first and user.is_authenticated %}
              {% if user.is_superuser or user|is_on_team:team or user|is_division_captain:league %}
                <a href="mailto:{% for captain in team.get_captains %}{{ captain.user.email }},{% endfor %}">Email Captains</a>
              {% endif %}
              {% endif %}

              {% if team_member.captain %}
                <span class="strong">
              {% endif %}

              {{ team_member.user.get_full_name }}

              {% if team_member.captain %}
                </span>
              {% endif %}

              <em>{{ team_member.user.profile.nickname }}</em>
            </li>
          {% endfor %}
        </ul>

        {% if request.user|in_group:'junta' %}
          <div class="team_notes text_center">
            <h5>Admin Only</h5>
            {{ team.get_members|length }} Player{{ team.get_members|length|pluralize }},
            {{ team.get_male_members|length }} Male{{ team.get_male_members|length|pluralize }},
            {{ team.get_female_members|length }} Female{{ team.get_female_members|length|pluralize }}
          </div>
        {% endif %}
      </div>

      {% if forloop.counter|divisibleby:2 %}
      </div><div class="page-division-teams-teams-row">
      {% endif %}
      {% empty %}
      <h4>
        Teams are not yet available
      </h4>
      {% endfor %}
    </div>
  </div>


  {% if teams and request.user|in_group:'junta' %}
    <div class="page-division-teams-notes">
      <div class="page-division-teams-notes-title">
        Admin Only
      </div>

      <div class="page-division-teams-notes-content">
        <dl>
          <dt>Division Email Address:</dt>
          <dd>
            {% if league.division_email %}
              <a href="mailto:{{ league.division_email }}">
                {{ league.division_email }}
              </a>
            {% else %}
              None
            {% endif %}
          </dd>
          <dt>Division Captains Email Address:</dt>
          <dd>
            {% if league.division_captains_email %}
              <a href="mailto:{{ league.division_captains_email }}">
                {{ league.division_captains_email }}
              </a>
            {% else %}
              None
            {% endif %}
          </dd>
        </dl>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}
