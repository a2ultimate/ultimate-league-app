{% extends 'layout/layout_user.html' %}

{% load leagues %}
{% load staticfiles %}
{% load utility %}

{% block title %}{{ first_division.season|smart_title }} League {{ year }} &middot; {{ block.super }}{% endblock %}
{% block og_title %}{{ block.super }} {{ year }} {{ first_division.season|smart_title }} League{% endblock %}

{% block description %}Ann Arbor Ultimate is proud to present {{ first_division.season|smart_title }} League {{ year }}.{% endblock %}
{% block og_description %}Ann Arbor Ultimate is proud to present {{ first_division.season|smart_title }} League {{ year }}.{% endblock %}

{% block content %}
  {% if not season %}
    {% include '_partials/league_list.html' with leagues=leagues link_view='league_summary' only %}
  {% else %}
    {% with league=leagues|first %}
      <h1>{% include '_partials/league_header.html' with league=league only %}</h1>

      <h4>
        Ann Arbor Ultimate is proud to present {{ league.season_title|smart_title }} League {{ year }}.
        There {{ leagues|pluralize:'is,are' }} <strong>{{ leagues|length }}</strong> division{{ leagues|pluralize }}.
      </h4>

      <hr>
    {% endwith %}

    {% for league in leagues %}
      <h2>
        {{ league.night_title|smart_title }}
        {% if league.type == 'league' %}Division{% endif %}
        ({{ league.gender_title|smart_title }})

        {% if league.state == 'preview' %}
          <em>({{ league.state|capfirst }})</em>
        {% endif %}
      </h2>

      {% if league.state == 'closed' or league.state == 'preview' or not league.is_after_registration_start %}
        <div class="message message-small">
          Registration is currently closed for this division.
          {% if league.state == 'open' %}
            It will open on {{ league.reg_start_date|date:'l, F jS' }}
            at {{ league.reg_start_date|date:'g:iA'|lower }}.
          {% elif league.state == 'preview' %}
            It is currently in preview mode.
          {% endif %}
        </div>
      {% endif %}

      {% if league.summary_info %}
        {{ league.summary_info|safe }}
      {% endif %}

      <table class="table table-striped-header">
        <tr>
          <td>
            <a href="{% url 'league_details' year=league.year season=league.season|slugify division=league.night|slugify %}">
              Detailed Info
            </a>
          </td>
          <td>
            <a href="{% url 'league_players' year=league.year season=league.season|slugify division=league.night|slugify %}">
              Players
            </a>
          </td>
          <td>
            <a href="{% url 'league_teams' year=league.year season=league.season|slugify division=league.night|slugify %}">
              Teams and Schedules
            </a>
          </td>
        </tr>
        <tr>
          <th colspan="2">
            {% ifequal league.league_start_date league.league_end_date %}
              Date
            {% else %}
              Dates
            {% endifequal %}
          </th>
          <th>
            Time
          </th>
        </tr>
        <tr>
          <td colspan="2">
            {% ifequal league.league_start_date league.league_end_date %}
              {{ league.league_start_date|date:'F d, Y' }}
            {% else %}
              {{ league.league_start_date|date:'F d, Y' }} through {{ league.league_end_date|date:'F d, Y' }}
            {% endifequal %}
          </td>
          <td>
            {{ league.times }}
          </td>
        </tr>
        <tr>
          <th colspan="3">
            Location
          </th>
        </tr>
        {% for field in league.fields.all %}
          <tr>
            <td colspan="3">
              {{ field.name }}

              {% if field.driving_link %}
                <small>
                  &middot;
                  <a href="{{ field.driving_link }}" target="_blank">
                    Directions
                  </a>
                </small>
              {% endif %}

              {% if field.layout_link %}
                <small>
                  &middot;
                  <a href="{% static field.layout_link %}" target="_blank">
                    Layout
                  </a>
                </small>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        <tr>
          <th colspan="2">
            Cost
          </th>
          <th>
            Maximum Group Size
          </th>
        </tr>
        <tr>
          <td>
            PayPal ${{ league.paypal_price|floatformat:2 }}
          </td>
          <td>
            {% if league.checks_accepted %}
              Check ${{ league.check_price|floatformat:2 }}
            {% endif %}
          </td>
          <td>
            {{ league.baggage }}
          </td>
        </tr>
        {% if not league.is_after_price_increase %}
          <tr>
            <td colspan="2">
              <em>The price will increase by ${{ league.late_cost_increase }} at {{ league.price_increase_start_date|date:'h:iA'|lower }} on {{ league.price_increase_start_date|date:'F d, Y' }}</em>
            </td>
            <td></td>
          </tr>
        {% endif %}
        <tr>
          <th colspan="3">
            Important Dates
          </th>
        </tr>
        <tr>
          <td>
            Registration Deadline
          </td>
          <td colspan="2">
            {{ league.waitlist_start_date|date:'F d, Y' }} at {{ league.waitlist_start_date|date:'h:iA'|lower }} or {{ league.max_players }} Players
          </td>
        </tr>
        {% if league.baggage > 1 %}
          <tr>
            <td>
              Group Edit Deadline
            </td>
            <td colspan="2">
              {{ league.waitlist_start_date|date:'F d, Y' }} at {{ league.waitlist_start_date|date:'h:iA'|lower }}
            </td>
          </tr>
        {% endif %}

        {% if league|is_open:user %}
          <tr>
            <td colspan="3">
              {% if league|is_waitlist:user %}
                <a class="button button-info" href="{% url 'league_registration' year=league.year season=league.season|slugify division=league.night|slugify %}">Join Waitlist</a>
              {% else %}
                <a class="button button-success" href="{% url 'league_registration' year=league.year season=league.season|slugify division=league.night|slugify %}">Register Now</a>
              {% endif %}
            </td>
          </tr>
        {% endif %}
      </table>
    {% endfor %}
  {% endif %}
{% endblock %}
