{% extends 'layout/layout_user.html' %}

{% load math %}
{% load leagues %}
{% load user_roles %}
{% load utility %}

{% block title %}Players &middot; {{ league.night_title|smart_title }} &middot; {{ league.season_title|smart_title }} {{ league.year }} &middot; {{ block.super }}{% endblock %}
{% block og_title %}{{ block.super }} {{ league.year }} {{ league.season_title|smart_title }} {{ league.night_title|smart_title }} Division Players{% endblock %}

{% block content %}
<div class="page-division-players">
  {% include '_partials/division_header.html' with league=league only %}

  {% include '_partials/league_tabs.html' with selected_tab='players' %}

  {% if not league.is_after_registration_start and not request.user|in_group:'junta' %}
    <div class="message">
      Players are not yet available.
    </div>
  {% else %}
    {% if league.is_after_waitlist_start %}
      <div class="message message-caution">
        The registration deadline has passed. All new registrations will be added to the waitlist.
      </div>
    {% elif num_registrations_remaining <= 0 %}
      <div class="message message-caution">
        This division is currently at capacity. All new registrations will be added to the waitlist.
      </div>
    {% elif num_registrations_remaining == league.max_players %}
      <div class="message message-info">
        There are {{ league.max_players }} spaces available. Be the first!
      </div>
    {% else %}
      <h4>
        There are {{ num_registrations_remaining }} of {{ league.max_players }} spaces available.
      </h4>
    {% endif %}

    {% if user_registration.is_complete and user_registration.league.baggage > 1 and not user_registration.waitlist and not league.is_after_group_lock_start %}
      <h3>Form a Group</h3>
      <p>
        The deadline for group changes is <strong>{{ league.group_lock_start_date|date:'l, F jS' }} at {{ league.group_lock_start_date|date:'g:iA'|lower }}</strong>.
        This division allows groups of up to <strong>{{ league.baggage }}</strong> (including you).
      </p>
      <p>
        <a class="button button-info button-small" href="{% url 'league_group' year=league.year season=league.season.slug division=league.night_slug  %}">
          Form a Group
        </a>
      </p>

      <hr>
    {% endif %}

    {% if waitlist_registrations|length %}
      <h3>Waitlist</h3>

      <ol>
        {% for registration in waitlist_registrations %}
          <li>{{ registration.user.get_full_name }}&nbsp;<em>{{ registration.user.profile.nickname }}</em></li>
        {% endfor %}
      </ol>
    {% endif %}

    <div class="page-division-players-players">
      <ul class="page-division-players-players-list">
        {% for registration in complete_registrations %}
        <li class="page-division-players-players-list-item">
          {{ registration.user.get_full_name }}
          <em>{{ registration.user.profile.nickname }}</em>
        </li>
        {% endfor %}
      </ul>
    </div>

    <div class="message message-small">
      <h4>Name not on the list?</h4>
      <ul class="no-spacing-list">
        <li>Feel free to <a href="mailto:registration@annarborultimate.org">email us at registration@annarborultimate.org</a>.</li>
      </ul>
    </div>

    {% if request.user|in_group:'junta' %}
    <div class="page-division-players-notes">
      <h4 class="page-division-players-notes-title">
        Admin Only
      </h4>

      <div class="page-division-players-notes-content">
        {% if unassigned_registrations|length %}
          <h3>Unassigned Registrations ({{ unassigned_registrations|length }})</h3>
          <table class="table table-condensed table-fixed">
            <thead>
              <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Registered</th>
              </tr>
            </thead>
            <tbody>
              {% for registration in unassigned_registrations|dictsort:'progress' %}
                <tr>
                  <td>{{ registration.user.get_full_name }}&nbsp;<em>({{ registration.user.profile.gender }})</em></td>
                  <td>{{ registration.status }}</td>
                  <td>{{ registration.registered|date:'Y/m/d h:iA' }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}

        {% if incomplete_registrations|length %}
          <h3>Incomplete Registrations ({{ incomplete_registrations|length }})</h3>
          <table class="table table-condensed table-fixed">
            <thead>
              <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Last Updated</th>
              </tr>
            </thead>
            <tbody>
              {% for registration in incomplete_registrations|dictsort:'progress'|dictsort:'updated' %}
                <tr>
                  <td>{{ registration.user.get_full_name }}&nbsp;<em>({{ registration.user.profile.gender }})</em></td>
                  <td>{{ registration.status }}</td>
                  <td>{{ registration.updated|date:'Y/m/d h:iA' }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}

        {% if refunded_registrations|length %}
          <h3>Refunded Registrations ({{ refunded_registrations|length }})</h3>
          <table class="table table-condensed table-fixed">
            <tbody>
              {% for registration in refunded_registrations|dictsort:'updated' %}
                <tr>
                  <td>{{ registration.user.get_full_name }}&nbsp;<em>({{ registration.user.profile.gender }})</em></td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}

        <dl>
          <dt>Complete Registrations:</dt>
          <dd>{{ complete_registrations|length }}</dd>
          <dt>Female Registrations:</dt>
          <dd>{{ num_registrations_female }}</dd>
          <dt>Male Registrations:</dt>
          <dd>{{ num_registrations_male }}</dd>
          <dt>Minor Registrations:</dt>
          <dd>{{ num_registrations_minor }}</dd>
        </dl>
      </div>
    </div>
    {% endif %}
  {% endif %}
</div>
{% endblock %}
